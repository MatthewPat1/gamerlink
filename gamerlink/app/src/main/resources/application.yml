server:
  port: 8080

spring:
  mail:
    host: localhost
    port: 1025
    username:
    password:
    properties:
      mail:
        smtp:
          auth: false
          starttls:
            enable: false
  config:
    import: optional:file:.env[.properties]
  datasource:
    url: ${DB_URL}
    username: ${DB_USER}
    password: ${DB_PASS}
  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        default_schema: public
        format_sql: true
    show-sql: true
  flyway:
    enabled: true

# Identity Module Configs
identity:
  app:
    rate-limit:
      password-reset:
        start-per-hour: 3
        verify-per-hour: 10
        ip-per-hour: 10
    security:
      jwt:
        secret: ${JWT_SECRET}
        issuer: ${APP_NAME}
        access-ttl-minutes: ${JWT_ACCESS_TTL}
      refresh-cookie:
        name: ${REFRESH_COOKIE_NAME}
        secure: false
        same-site: LAX
        path: /api/auth
        refresh-ttl-days: ${REFRESH_TOKEN_TTL}
      token:
        pepper: ${TOKEN_PEPPER}
    mail:
      from: "no-reply@gamerlink.local"
      reset:
        subject: "Your GamerLink password reset code"

shared:
  app:
    redis:
      enabled: true
    rate-limit:
      fail-open: false  # Fail closed by default (deny on Redis failure)
      global:
        default-max-attempts: 100
        default-window-seconds: 3600

  spring:
    data:
      redis:
        host: ${REDIS_HOST:localhost}
        port: ${REDIS_PORT:6379}
        password: ${REDIS_PASSWORD:}
        timeout: 2000ms
        lettuce:
          pool:
            max-active: 8
            max-idle: 8
            min-idle: 2
            max-wait: -1ms
          shutdown-timeout: 100ms